# 参照

Move言語は、値への参照を作成する機能を提供します。参照は、値を移動させることなく値を読み取ったり変更したりする方法を提供します。

参照には2種類あります：

- 不変参照`&e`は、値を読み取ることのみを許可します
- 可変参照`&mut e`は、値の読み取りと変更の両方を許可します

## 参照の作成

参照は、`&`または`&mut`演算子を使用して作成できます：

```move
let s = b"hello";
let s_ref = &s; // 不変参照
let s_mut_ref = &mut s; // 可変参照
```

参照は、フィールドへのアクセスでも作成できます：

```move
struct Balance {
    value: u64
}
fun add_balance(balance: &mut Balance, amount: u64) {
    balance.value = balance.value + amount // balance.valueは&mut u64を返します
}
```

## 参照を通じた読み取りと書き込み

参照を通じて値を読み取るには、`*`演算子を使用します：

```move
let x = 7;
let y = &x;
let z = *y; // zは7になります
```

可変参照を通じて値を書き込むには、`*`演算子を使用するか、参照を通じて直接代入します：

```move
let mut x = 7;
let y = &mut x;
*y = 42; // xは42になります
```

## 参照演算子

参照は、以下の演算子をサポートしています：

| 演算子     | 説明                                                |
| ---------- | -------------------------------------------------- |
| `&e`       | 式`e`への不変参照を作成します                      |
| `&mut e`   | 式`e`への可変参照を作成します                      |
| `*e`       | 参照`e`を通じて値を読み取ります                    |
| `*e1 = e2` | 参照`e1`を通じて値を書き込みます                  |
| `freeze(e)` | 可変参照を不変参照に変換します                    |

## 参照の安全性

Moveの参照システムは、以下の保証を提供します：

- 参照は常に有効な値を指します（ダングリング参照はありません）
- 可変参照は一意です（エイリアシングはありません）
- 参照は借用期間中に元の値が移動されることを防ぎます

これらの保証は、コンパイル時に静的に強制されます。

## 所有権と借用

参照は値を「借用」します。借用期間中：

- 不変参照が存在する場合、値は移動できず、可変参照を作成することもできません
- 可変参照が存在する場合、値は移動できず、他の参照（不変または可変）を作成することもできません

```move
let v = 7;
let v_ref = &v;
let v_ref2 = &v; // OK - 複数の不変参照を持つことができます
let y = move v; // エラー！vは借用されています
```

借用期間は、参照が最後に使用された後に終了します。
