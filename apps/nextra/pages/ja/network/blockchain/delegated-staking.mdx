---
title: "委任ステーキング"
---

import { Callout } from "nextra/components";

# 委任ステーキング

## Aptosブロックチェーンにおける委任ステーキング

<Callout type="info">
  先に[ステーキング](staking.mdx)についてお読みいただくことを強くお勧めします。
</Callout>

委任ステーキングは、ステーキングプロトコルの拡張です。委任プールは、ステーク所有者を、委任者からステークを集めてバリデータに紐付けられたネイティブステークプールに追加できるエンティティとして抽象化します。これにより、複数のエンティティがバリデータセットに参加するための最小要件を満たすステークプールを形成することができます。委任者は非アクティブなプールにステークを追加できますが、委任プールはアクティブになるまで報酬を獲得できません。

<Callout type="warning">
  委任プールはパーミッションレスで、誰でもステークを追加できます。委任プールは一度作成されるとステークプールに変更することはできません（その逆も同様）。ただし、バリデータセットから削除して資産を引き出すことは可能です。ステークプールの詳細については、[ステーキング](staking.mdx)をご覧ください。
</Callout>

委任プールのスマートコントラクトの全容については、[delegation_pool.move](https://github.com/aptos-labs/aptos-core/blob/main/aptos-move/framework/aptos-framework/sources/delegation_pool.move)をご覧ください。

ステークプールとは異なり、委任プールはゼロステークで初期化できます。初期化時、委任ステークプールはリソースアカウントを介して間接的に所有されます。このアカウントは、委任者に代わって基礎となるステークプールのステークを管理します（追加、ロック解除、再アクティブ化、引き出し）。リソースアカウントは直接アクセスすることも外部から所有することもできません。

[委任プールの操作](../nodes/validator-node/connect-nodes/delegation-pool-operations.mdx)の全リストをご覧ください。

![image](https://user-images.githubusercontent.com/120680608/234953723-ae6cc89e-76d8-4014-89f3-ec8799c7b281.png)

5つのエンティティタイプがあります：

- オーナー
- オペレーター
- 投票者
- 委任者
- 受益者

このモデルでは、オーナーはAptosブロックチェーンでステークする必要なくバリデータを運用できます。

[Aptosブロックチェーンでの検証の仕組み](staking.mdx#validation-on-the-aptos-blockchain)

### オーナー

委任プールのオーナーには以下の権限があります：

1. 委任プールの作成
2. 委任プールのオペレーターの割り当て
3. 委任プールのオペレーター手数料率の設定
4. 委任プールの投票者の割り当て

### オペレーター

ノードオペレーターは、プールオーナーによってバリデータノードを運用するために割り当てられます。オペレーターには以下の権限があります：

1. 委任プールが1M APTに達した時点でバリデータセットへの参加または離脱
2. 検証機能の実行
3. コンセンサスキーとネットワークアドレスの変更。コンセンサスキーは、バリデータのコンセンサスプロセス（ブロックの提案と投票）に参加するために使用されます。オペレーターは、このキーが漏洩した場合に変更（「ローテーション」）することができます。

オペレーターは、各エポックの終わりに自動的に分配される手数料を受け取ります。

### 投票者

オーナーは投票者を指定できます。これにより、投票者はガバナンスに参加できます。投票者は投票キーを使用してガバナンス投票のトランザクションに署名します。

<Callout type="info">
  このドキュメントではステーキングについて説明しています。オーナー・投票者モデルを使用してAptosのオンチェーンガバナンスに参加する方法については、[ガバナンス](governance.mdx)をご覧ください。
</Callout>

### 委任者

委任者は、委任プールにステークを持つ人です。委任者は、オペレーターへの手数料を差し引いたステークに対して報酬を獲得します。委任者は以下の委任操作を実行できます：

1. ステークの追加
2. ステークのロック解除
3. ステークの再アクティブ化
4. ステークの引き出し

### 受益者

受益者は、オペレーター手数料報酬を受け取るためにオペレーターが指定したアドレスです。受益者の役割の主要な側面：

1. 各オペレーターは、すべての委任プールで1つの受益者アドレスのみを設定できます
2. 受益者は、獲得した手数料のロック解除や引き出しなどの操作を実行できます
3. 受益者を変更する場合、未払いの手数料報酬は新しい受益者に支払われます
4. オペレーターは`set_beneficiary_for_operator`関数を使用して受益者を設定または変更できます

## バリデータのフロー

<Callout type="info">
  以下のフローに対応する正しいコマンドシーケンスについては、[委任プールの操作](../nodes/validator-node/connect-nodes/delegation-pool-operations.mdx)をご覧ください。
</Callout>

1. [オペレーターがバリデータノードをデプロイ](../nodes/validator-node.mdx)
2. [委任プールアドレスを取得するコマンドを実行](../nodes/validator-node/connect-nodes/delegation-pool-operations.mdx#prerequisites)
3. [オペレーターがステップ2で取得したプールアドレスを使用してネットワークに接続](../nodes/validator-node/connect-nodes/connect-to-aptos-network.mdx)
4. [オーナーが委任プールを初期化してオペレーターを設定](../nodes/validator-node/connect-nodes/delegation-pool-operations.mdx#initialize-a-delegation-pool)
5. 委任者はいつでもステークを追加可能
6. 委任プールが1M APTに達すると、オペレーターはaptos node join-validator-setを呼び出してアクティブなバリデータセットに参加できます。変更は次のエポックから有効になります
7. バリデータが検証（リーダーバリデータとしてブロックを提案）を行い、報酬を獲得します。報酬はステーク額に比例して委任者に分配されます。ステークは自動的に固定期間（ガバナンスによって設定）ロックアップされ、期限切れ時に自動的に更新されます
8. オペレーターは任意のタイミングでaptos node update-consensus-keyまたはaptos node update-validator-network-addressesを呼び出して、コンセンサスキーまたはバリデータネットワークアドレスを更新できます。ステークの変更と同様に、コンセンサスキーまたはバリデータネットワークアドレスの変更は次のエポックから有効になります
9. 委任者はいつでもステークのロック解除を要求できます。ただし、委任プールのロックアップ期間が終了するまでステークを引き出すことはできません
10. バリデータはaptos node leave-validator-setを呼び出して明示的にバリデータセットを離脱するか、ステークが最小要件を下回った場合はエポック終了時に削除されます

## バリデータセットへの参加

Aptosネットワークで委任バリデータノードとして参加する方法は以下の通りです：

1. オペレーターがバリデータノードを実行し、オンチェーンのバリデータネットワークアドレスを設定してコンセンサスキーをローテーションします
2. オーナーが委任プールを初期化します
3. バリデータノードは委任プールがアクティブになるまで同期できません。委任プールは1M APTに達するとアクティブになります
4. オペレーターが検証を行い、報酬を獲得します
5. ステークプールは自動的に固定期間（Aptosガバナンスによって設定）ロックアップされ、期限切れ時に自動的に更新されます。手数料は報酬として自動的にオペレーターに分配されます。オペレーターはいつでもステークをロック解除できますが、委任プールのロックアップ期間が終了するまで引き出すことはできません
6. オペレーターは新しいエポックが開始するまでバリデータがアクティブになるのを待つ必要があります

<Callout type="info">
  バリデータセットへの参加手順については、[バリデータセットへの参加](../nodes/validator-node/connect-nodes/connect-to-aptos-network.mdx#join-the-validator-set)をご覧ください。
</Callout>

### 自動ロックアップ期間

オペレーターがバリデータセットに参加すると、委任プールのステークは自動的にAptosガバナンスによって設定された固定期間ロックアップされます。委任者は委任プールのロックアップサイクルに従います。

### 自動ロックアップ更新

ロックアップ期間が終了すると自動的に更新され、バリデータは検証を継続して報酬を受け取ることができます。

### ステークのロック解除

委任者はいつでもステークをロック解除できます。ただし、委任プールのロックアップ期間が終了するまでステークを引き出すことはできません。ロック解除されたステークは、引き出し可能になるまで報酬を獲得し続けます。

### ロックアップのリセット

ロックアップはリセットできません。

## 報酬

委任ステーキングの報酬は以下を使用して計算されます：

1. 報酬率（年率利回り、APY）。つまり、現在のステーク額に対して複利で報酬が発生します
2. 委任者のステーク
3. [バリデータの報酬パフォーマンス](staking.mdx#rewards-formula)

[委任プール報酬の計算](../nodes/validator-node/connect-nodes/delegation-pool-operations.mdx#compute-delegation-pool-rewards-earned)をご覧ください
