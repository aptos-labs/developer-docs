---
title: "升级节点"
---

import { Callout, Steps } from 'nextra/components';

# 升级节点

本节包含有关升级您的验证者和验证者全节点（VFN）的教程。升级是维护您的节点的常规操作。Aptos Labs 经常发布 Aptos 节点软件的新版本，您应该保持您的节点为最新版本以确保它们的安全性和可靠性。

<Callout type="warning">
运行旧版本的节点并且未及时更新您的节点可能会导致安全漏洞、性能下降和网络不稳定。保持您的节点为最新版本非常重要。
</Callout>

更新你的节点主要有两种方法。第一种是直接升级节点软件，这是一种**简单升级**的操作。第二种则涉及更为**复杂的故障转移**的机制，即在你的验证者和验证者全节点（VFN）之间进行故障转移，这一步骤在升级过程中特别有助于减少验证者节点的停机时间。

## 简单升级

要执行简单的节点升级，您可以逐步升级验证者节点和 VFN。这个过程简单明了，并且可以为每个节点重复执行。步骤如下：

1. 首先，手动停止节点（例如，验证者或 VFN）。要停止节点，将取决于您的部署方法。
2. 接下来，将节点软件更新到最新版本。这可能需要下载最新的二进制文件或 Docker 镜像，或者重新编译源代码。根据您的部署方法，您可以在节点仍在运行的时候在后台执行此步骤。这应该有助于最小化停机时间。
3. 最后，一旦您更新了节点软件，使用最新的软件版本和您用于启动节点的原始命令重新启动节点。

   <Callout type="info">
   **对每个节点重复操作**<br />
   您需要为每个节点单独执行简单升级过程。这意味着您需要分别升级验证者和 VFN。
   </Callout>

<br />

## 通过 VFN 故障转移升级

为了尽可能减少验证者的非停机时间，你可以在你的验证者与 VFN 之间进行故障转移。具体来说，先将 VFN 升级至最新版本，并使之成为新的验证者。这一步完成后，旧的验证者再进行升级，并转变为新的 VFN。通过这样的方式，可以确保在整个过程中，系统的稳定性和可用性得到最大程度的保障。

采用这种升级方式的优势在于，它可以让你在当前验证者还在运行时，就开始准备新的验证者，从而尽量减少验证者的停机时间。

<Callout type="warning">
**节点差异**<br />
在开始故障转移过程之前，了解两个节点（即验证者和 VFN）维护的数据并不相同非常重要。VFN 缺少 `consensus_db` 和 `secure-data.json` 文件，并且两个节点使用不同的配置文件（包括身份）。

如果您对故障转移过程不熟悉，您应该考虑执行简单升级。
</Callout>

要执行 VFN 故障转移升级，您应该按照以下步骤操作：

1. 更新您的 DNS，以交换验证者和 VFN 之间的[网络地址](../../validator-node/connect-nodes/connect-to-aptos-network#3-更新链上网络地址)。
2. 停止 VFN 并将节点软件更新到最新版本。这可能需要下载最新的二进制文件或 Docker 镜像，或者重新编译源代码。此外，您需要从验证者节点复制 `consensus_db` 和 `secure-data.json` 文件到 VFN，以及验证者节点的配置文件（包括验证者身份）。
3. 一旦 VFN 准备好成为新的验证者，您可以停止旧的验证者，并立即启动新的验证者。这将最小化验证者的停机时间。

   <Callout type="warning">
   **一次只有一个验证者运行** <br />
   非常重要的一点是，要确保任何时候系统中只运行着一台验证者。如果在新验证者启动之前没有先停掉原有的验证者，将会出现两台验证者同时运行的情况，这样的状况会导致节点共识失败，进而引发性能问题。
   </Callout>

4. 、此时，你的系统中会运行着一个安装了新版本代码的验证者。重要的是需要注意，在 DNS 的更改生效之前，新验证者只能建立出站的连接。
5. 接下来，准备原始验证者成为新的 VFN。这将涉及将节点软件更新到最新版本，并复制 VFN 配置文件（包括 VFN 身份）。
6. 一旦原始验证者准备好成为新的 VFN，您可以启动新的 VFN。

<Callout type="info">
完成故障转移过程后，您应该监控新的验证者和 VFN 以确保它们运行正常，并确保您的验证者仍在参与共识。
</Callout>
